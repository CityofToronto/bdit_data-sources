SET TIME ZONE 'America/Toronto';
\COPY (SELECT segment_name AS "resultId", tt::INT as "timeInSeconds", obs as count, REPLACE(to_char( (datetime_bin AT TIME ZONE 'America/Toronto' + interval '5 minutes'), 'YYYY-MM-DD HH24:MI:SSOF'), ' ', 'T') as updated FROM bluetooth.aggr_5min  INNER JOIN bluetooth.ref_segments USING (analysis_id) INNER JOIN bluetooth.public_routes USING (segment_name) WHERE EXTRACT(year from datetime_bin) = '2014' ) TO 'C:\Users\aharpal\Documents\bluetooth_export\bt_2014.csv' WITH (FORMAT 'csv', HEADER TRUE); 
\COPY (SELECT segment_name AS "resultId", tt::INT as "timeInSeconds", obs as count, REPLACE(to_char( (datetime_bin AT TIME ZONE 'America/Toronto' + interval '5 minutes'), 'YYYY-MM-DD HH24:MI:SSOF'), ' ', 'T') as updated FROM bluetooth.aggr_5min INNER JOIN bluetooth.ref_segments USING (analysis_id) INNER JOIN bluetooth.public_routes USING (segment_name) WHERE EXTRACT(year from datetime_bin) = '2015' ) TO 'C:\Users\aharpal\Documents\bluetooth_export\bt_2015.csv' WITH (FORMAT 'csv', HEADER TRUE);
\COPY (SELECT segment_name AS "resultId", tt::INT as "timeInSeconds", obs as count, REPLACE(to_char( (datetime_bin AT TIME ZONE 'America/Toronto' + interval '5 minutes'), 'YYYY-MM-DD HH24:MI:SSOF'), ' ', 'T') as updated FROM bluetooth.aggr_5min INNER JOIN bluetooth.ref_segments USING (analysis_id) INNER JOIN bluetooth.public_routes USING (segment_name) WHERE EXTRACT(year from datetime_bin) = '2016' ) TO 'C:\Users\aharpal\Documents\bluetooth_export\bt_2016.csv' WITH (FORMAT 'csv', HEADER TRUE);
\COPY (SELECT segment_name AS "resultId", tt::INT as "timeInSeconds", obs as count, REPLACE(to_char( (datetime_bin AT TIME ZONE 'America/Toronto' + interval '5 minutes'), 'YYYY-MM-DD HH24:MI:SSOF'), ' ', 'T') as updated FROM bluetooth.aggr_5min INNER JOIN bluetooth.ref_segments USING (analysis_id) INNER JOIN bluetooth.public_routes USING (segment_name) WHERE EXTRACT(year from datetime_bin) = '2017' ) TO 'C:\Users\aharpal\Documents\bluetooth_export\bt_2017.csv' WITH (FORMAT 'csv', HEADER TRUE);
